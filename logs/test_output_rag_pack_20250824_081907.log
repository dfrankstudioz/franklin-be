[+] Running rag_pack tests...
FFF....FFFFFFFF
=================================== FAILURES ===================================
____________________________ test_fallback_to_chat _____________________________

    def test_fallback_to_chat():
        url = "http://localhost:9006/chat"
        payload = {"prompt": "whats for dinner"}
        headers = {"Content-Type": "application/json"}
    
        response = requests.post(url, json=payload, headers=headers)
        assert response.status_code == 200
    
        result = response.json()
        assert "response" in result
>       assert result["response"].strip().startswith("chat("), f'Unexpected response: {result["response"]}'
E       AssertionError: Unexpected response: Sorry, I couldn't understand the request.
E       assert False
E        +  where False = <built-in method startswith of str object at 0x7f401ab5b7b0>('chat(')
E        +    where <built-in method startswith of str object at 0x7f401ab5b7b0> = "Sorry, I couldn't understand the request.".startswith
E        +      where "Sorry, I couldn't understand the request." = <built-in method strip of str object at 0x7f401ab5b7b0>()
E        +        where <built-in method strip of str object at 0x7f401ab5b7b0> = "Sorry, I couldn't understand the request.".strip

tests/rag_pack/test_fallback_to_chat.py:19: AssertionError
______________________________ test_list_dir_tool ______________________________

    def test_list_dir_tool():
>       result = list_dir("/memory")
E       TypeError: 'module' object is not callable

tests/rag_pack/test_list_dir.py:14: TypeError
_______________________ test_natural_prompt_to_read_file _______________________

    def test_natural_prompt_to_read_file():
        url = "http://localhost:9006/chat"
        payload = {"prompt": "read /memory/test.txt"}
        headers = {"Content-Type": "application/json"}
    
        response = requests.post(url, json=payload, headers=headers)
>       assert response.status_code == 200, f"Expected 200 OK, got {response.status_code}"
E       AssertionError: Expected 200 OK, got 500
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/rag_pack/test_natural_prompt_routing.py:15: AssertionError
_____________________________ test_read_file_tool ______________________________

    def test_read_file_tool():
>       result = read_file("/memory/stub_file_1.txt")
E       TypeError: 'module' object is not callable

tests/rag_pack/test_read_file.py:14: TypeError
___________________________ test_summarize_file_tool ___________________________

    def test_summarize_file_tool():
>       result = summarize_file("/memory/stub_file_1.txt")
E       TypeError: 'module' object is not callable

tests/rag_pack/test_summarize_file.py:14: TypeError
_____________________________ test_command_clarity _____________________________

    def test_command_clarity():
        res = requests.post("http://localhost:9006/chat", json={"prompt": "can you summarize the file called example.txt"})
>       assert res.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/rag_pack/tests/test_rag_command_clarity.py:5: AssertionError
______________________________ test_empty_prompt _______________________________

    def test_empty_prompt():
        res = requests.post("http://localhost:9006/chat", json={"prompt": ""})
        assert res.status_code == 200
>       assert "empty" in res.json()["response"].lower() or "invalid" in res.json()["response"].lower()
E       assert ('empty' in "sorry, i couldn't understand the request." or 'invalid' in "sorry, i couldn't understand the request.")
E        +  where "sorry, i couldn't understand the request." = <built-in method lower of str object at 0x7f401abb8570>()
E        +    where <built-in method lower of str object at 0x7f401abb8570> = "Sorry, I couldn't understand the request.".lower
E        +  and   "sorry, i couldn't understand the request." = <built-in method lower of str object at 0x7f401abb8690>()
E        +    where <built-in method lower of str object at 0x7f401abb8690> = "Sorry, I couldn't understand the request.".lower

tests/rag_pack/tests/test_rag_empty_prompt.py:6: AssertionError
______________________________ test_invalid_path _______________________________

    def test_invalid_path():
        res = requests.post("http://localhost:9006/chat", json={"prompt": "read file /notreal/path.txt"})
>       assert res.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/rag_pack/tests/test_rag_invalid_path.py:5: AssertionError
______________________________ test_missing_file _______________________________

    def test_missing_file():
        res = requests.post("http://localhost:9006/chat", json={"prompt": "summarize /memory/missing.txt"})
>       assert res.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/rag_pack/tests/test_rag_missing_file.py:5: AssertionError
_______________________________ test_openai_down _______________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f401abbc650>

    def test_openai_down(monkeypatch):
        monkeypatch.setenv("OPENAI_API_KEY", "invalid_key")
        res = requests.post("http://localhost:9006/chat", json={"prompt": "summarize /memory/example.txt"})
>       assert res.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/rag_pack/tests/test_rag_openai_down.py:6: AssertionError
_____________________________ test_partial_command _____________________________

    def test_partial_command():
        res = requests.post("http://localhost:9006/chat", json={"prompt": "summarize /memory"})
        assert res.status_code == 200
>       assert "directory" in res.json()["response"].lower() or "invalid" in res.json()["response"].lower()
E       assert ('directory' in "sorry, i couldn't understand the request." or 'invalid' in "sorry, i couldn't understand the request.")
E        +  where "sorry, i couldn't understand the request." = <built-in method lower of str object at 0x7f401abb94d0>()
E        +    where <built-in method lower of str object at 0x7f401abb94d0> = "Sorry, I couldn't understand the request.".lower
E        +  and   "sorry, i couldn't understand the request." = <built-in method lower of str object at 0x7f401abb92f0>()
E        +    where <built-in method lower of str object at 0x7f401abb92f0> = "Sorry, I couldn't understand the request.".lower

tests/rag_pack/tests/test_rag_partial_command.py:6: AssertionError
=========================== short test summary info ============================
FAILED tests/rag_pack/test_fallback_to_chat.py::test_fallback_to_chat - Asser...
FAILED tests/rag_pack/test_list_dir.py::test_list_dir_tool - TypeError: 'modu...
FAILED tests/rag_pack/test_natural_prompt_routing.py::test_natural_prompt_to_read_file
FAILED tests/rag_pack/test_read_file.py::test_read_file_tool - TypeError: 'mo...
FAILED tests/rag_pack/test_summarize_file.py::test_summarize_file_tool - Type...
FAILED tests/rag_pack/tests/test_rag_command_clarity.py::test_command_clarity
FAILED tests/rag_pack/tests/test_rag_empty_prompt.py::test_empty_prompt - ass...
FAILED tests/rag_pack/tests/test_rag_invalid_path.py::test_invalid_path - ass...
FAILED tests/rag_pack/tests/test_rag_missing_file.py::test_missing_file - ass...
FAILED tests/rag_pack/tests/test_rag_openai_down.py::test_openai_down - asser...
FAILED tests/rag_pack/tests/test_rag_partial_command.py::test_partial_command
11 failed, 4 passed in 0.17s
